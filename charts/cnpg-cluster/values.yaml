imageName: ghcr.io/cloudnative-pg/postgresql:17.6-minimal-trixie

instances: 3

affinity: {}

superuser:
  enabled: false
  secret:
    name: superuser-credentials
    labels:
      cnpg.io/reload: "true"

# PostgreSQL pod resources
resources:
  requests:
    memory: 512Mi
    cpu: 300m
  limits:
    memory: 512Mi
    cpu: 300m

# Pooler pod resources
poolerResources:
  requests:
    memory: 128Mi
    cpu: 60m
  limits:
    memory: 256Mi
    cpu: 180m

# Connection allocation strategy
# Total max_connections will be calculated from memory, then distributed:
connections:
  # Reserved connections: CNPG replication, monitoring, migrations, psql, pgAdmin, maintenance
  # Includes superuser access, background workers, and emergency access
  # Recommended minimum: 10
  reserved: 10

  # Pooler connections: For application connections via PgBouncer
  # Set to 0 to disable pooler, set to "auto" to allocate remaining connections
  # Cannot be "auto" if direct is also "auto"
  pooler: 0

  # Direct connections: Uses internal connection pooling
  # Set to "auto" to allocate remaining connections after reserved and pooler
  # Cannot be "auto" if pooler is also "auto"
  # Automatically calculated as: max_connections - reserved - pooler
  direct: auto

storageClass: standard
storageSize: 4Gi

objectStore:
  endpoint: https://s3.ap-southeast-1.amazonaws.com
  bucketName: cnpg-backups
  s3CredentialsSecretName: aws-credentials
  s3AccessKeyIdSecretKey: accessKeyId
  s3SecretAccessKeySecretKey: secretAccessKey

backup:
  enabled: true
  schedule: ""

recovery:
  # ========================================================================
  # DISASTER RECOVERY MODES
  # ========================================================================
  #
  # Mode 1: "fresh" - Create new cluster with fresh data
  # Mode 2: "production" - Use recovery bootstrap (prevents fresh cluster creation)
  # Mode 3: "recovery" - Recover from specific timeline
  #
  mode: "fresh" # Options: fresh, production, recovery
  # https://cloudnative-pg.io/documentation/current/recovery/#recovery-targets
  target: {}
  # Timeline configuration
  timeline:
    # Source reader timeline (set to writer timeline after successful recovery)
    # This makes future recoveries easier by avoiding timeline searches
    reader: ""
    # Current writer timeline (update this for disaster recovery)
    # Format: ISO 8601 timestamp (e.g., "2025-09-23T14:59:00+08:00")
    writer: ""

managedRoles:
  - name: app
    ensure: present
    login: true
    createrole: true
    bypassrls: true

pooler:
  rw:
    enabled: true
    instances: 1
    mode: transaction
  ro:
    enabled: true
    instances: 1
    mode: transaction
